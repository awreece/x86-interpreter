<!DOCTYPE html>
<html lang="en" ng-app="x86interpreter">
  <head>
    <title>Code Arcana</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0-wip/css/bootstrap.min.css">
    <link rel="stylesheet" href="./main.css" type="text/css" />
    <script src="./x86.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
    <script src="./ui-bootstrap-tpls-0.5.0.min.js"></script>
    <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script>
      state = new State();
      function StateController($scope) {
        $scope.all_registers = all_registers;
        $scope.state = state;
        $scope.hex = hex;
        $scope.range = range;
        $scope.parseInt = parseInt;
        $scope.keys = Object.keys;
      }

      var mod = angular.module('x86interpreter', ['ui.bootstrap']);
      mod.factory('$exceptionHandler', function () {
        return function (exception, cause) {
          alert(exception);
        };
      }); 
    </script>
  </head>
  <body>
    <div ng-controller="StateController" class="container">
      <div class="row">
        <div class="stack col-xs-4">
          <h2>Stack</h2>
          <div class="memory" ng-repeat="address in range(state.stackBase - 4, state.stackBase - 40, -4)">
            <span class="text-muted">{{hex(address)}}</span> 
            <span ng-dblclick="isEditing=!isEditing" ng-init="isEditing=false">
              <form class="inline" ng-show="isEditing" ng-submit="state.setMemory(address,parseInt(newVal));isEditing=false">
                <input type="text" ng-model="newVal" size="10">
                <input ng-show="false" type="submit">
              </form>
              <span ng-show="!isEditing">{{hex(state.getMemory(address))}}</span>
            </span>
          </div>
        </div>
        <div class="registers col-xs-4">
          <h2>Registers</h2>
          <div class="register" ng-repeat="register in all_registers">
            <span class="text-muted">%{{register}}</span>
            <span ng-dblclick="isEditing=!isEditing" ng-init="isEditing=false">
              <form class="inline" ng-show="isEditing" ng-submit="state[register]=parseInt(newVal);isEditing=false">
                <input type="text" ng-model="newVal" size="10">
                <input ng-show="false" type="submit">
              </form>
              <span ng-show="!isEditing">{{hex(state[register])}}</span>
            </span>
          </div>
        </div>
        <div class="instructions col-xs-4">
          <h3>Code</h3>
          <form class="inline" ng-submit="state.setCode(state.eip,command);state.step();command=''">
            <input type="text" ng-model="command" size="50"
            placeholder="Add a command...">
            <button class="btn btn-primary" type="submit">Run</button>
          </form>
          <div class="instruction" ng-repeat="address in range(state.codeBase+40-4, state.codeBase-4, -4)">
            {{hex(address)}} {{state.getCode(address)}}
          </div>
        </div>
      </div>
      <p>Double click a value to edit it!</p>
    </div>
  </body>
</html>
